



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Build and run locally - Order Microservice CQRS and Event Sourcing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#build-and-run-the-order-microservices-locally" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Order Microservice CQRS and Event Sourcing" class="md-header-nav__button md-logo">
          
            <img src="../images/cloud.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Order Microservice CQRS and Event Sourcing
            </span>
            <span class="md-header-nav__topic">
              Build and run locally
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-order-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Order Microservice CQRS and Event Sourcing" class="md-nav__button md-logo">
      
        <img src="../images/cloud.png" width="48" height="48">
      
    </a>
    Order Microservice CQRS and Event Sourcing
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-order-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      From event storming to CQRS microservice
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        From event storming to CQRS microservice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ddd-applied/" title="Order subdomain - analysis and design" class="md-nav__link">
      Order subdomain - analysis and design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../implementation-considerations/" title="Implementation considerations" class="md-nav__link">
      Implementation considerations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Development practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Development practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build and run locally
      </label>
    
    <a href="./" title="Build and run locally" class="md-nav__link md-nav__link--active">
      Build and run locally
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" title="Run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-docker-compose" title="With docker compose" class="md-nav__link">
    With docker compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-on-kubernetes-cluster" title="Deploy on kubernetes cluster" class="md-nav__link">
    Deploy on kubernetes cluster
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployments/" title="Deploy to Kubernetes cluster" class="md-nav__link">
      Deploy to Kubernetes cluster
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/design-patterns/event-sourcing" title="Event sourcing pattern" class="md-nav__link">
      Event sourcing pattern
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/design-patterns/cqrs" title="CQRS pattern" class="md-nav__link">
      CQRS pattern
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/itg-tests/" title="Integration tests" class="md-nav__link">
      Integration tests
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" title="Run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-docker-compose" title="With docker compose" class="md-nav__link">
    With docker compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-on-kubernetes-cluster" title="Deploy on kubernetes cluster" class="md-nav__link">
    Deploy on kubernetes cluster
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-kc-order-ms/edit/master/docs/build-run.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="build-and-run-the-order-microservices-locally">Build and run the order microservices locally</h1>
<p>We support different deployment models for event streams and the reefer solution: local with docker-compose, and remote using kubernetes on IBM Cloud (IKS), or on premise with Openshift. </p>
<p>When developing the microservice we can access kafka / event streams remote deployed on IBM Cloud or running locally via docker compose. </p>
<p>To build and run we are proposing to use some shell scripts. Each script accepts one argument:</p>
<ul>
<li>LOCAL (default if no argument): it uses the kafka image as define in docker compose from the <code>refarch-kc</code> project.</li>
<li>IBM_CLOUD : to access event streams as service on IBM Cloud.</li>
<li>ICP : to access event streams deployed on Openshift cluster on premise. </li>
</ul>
<p>This argument is used to set environment variables used in the code.  In fact the <code>setenv.sh</code> script is used, and is defined in the root <code>refarch-kc</code> project and the <code>scripts</code> folder.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>You can have the following software already installed on your computer or use <a href="https://github.com/ibm-cloud-architecture/refarch-kc/blob/master/docker/docker-java-tools">our docker images</a> to get those dependencies integrated in docker images, which you can use to build, test and package the java programs.</p>
<ul>
<li><a href="https://maven.apache.org/install.html">Maven</a></li>
<li>Java 8: Any compliant JVM should work like:</li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8 JDK from Oracle</a></li>
<li><a href="http://www.ibm.com/developerworks/java/jdk/">Java 8 JDK from IBM (AIX, Linux, z/OS, IBM i)</a></li>
<li>For IBMCLOUD, you need to be sure to have an Event Stream service defined (See <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/backing-services/#using-ibm-event-streams-hosted-on-ibm-cloud">this note</a> for a simple summary of what to do). </li>
<li>If you run IBM Event Streams on openshift cluster on premise servers, be sure to get truststore certificates and API key.</li>
<li>Configure the following topics for both microservices: <code>orderCommands</code>, <code>errors</code>, <code>orders</code>. You can use the script <code>createTopics.sh</code> in the <code>refarch-kc</code> project for that or use the Event Streams user interface.</li>
</ul>
<h2 id="build">Build</h2>
<p>There are two separate folders to manage the code and scripts for the CQRS command and query parts:</p>
<ul>
<li>order-command-ms</li>
<li>order-query-ms</li>
</ul>
<p>You need to build each microservice independently using maven.</p>
<p>Each microservice has its own build script to perform the maven package and build the docker image. See <code>scripts</code> folder under each project.</p>
<p>Any microservice in this repository can be compiled, unit tested and packaged as war file using maven: <code>mvn package</code></p>
<ul>
<li>For order-command-ms, the following command will run unit tests and package the war file, then build a docker image</li>
</ul>
<div class="codehilite"><pre><span></span>cd order-command-ms
./scripts/buildDocker.sh IBMCLOUD
</pre></div>

<p>If you want to run the integration test you need to do the following:
<div class="codehilite"><pre><span></span>source ../../refarch-kc/scripts/setenv.sh IBMCLOUD
mvn install   
or
mvn integration-test
</pre></div></p>
<ul>
<li>For order-query-ms</li>
</ul>
<div class="codehilite"><pre><span></span>./scripts/buildDocker.sh IBMCLOUD
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note<p>The build scripts test if the javatool docker image exists and if so they use it, otherwise they use maven.
If you want to use docker compose use LOCAL as parameter.</p>
</p>
</div>
<ul>
<li>Verify the docker images are created</li>
</ul>
<div class="codehilite"><pre><span></span>docker images

ibmcase/kc-orderqueryms  latest b85b43980f35 531MB
ibmcase/kc-ordercommandms latest 
</pre></div>

<h2 id="run">Run</h2>
<p>You can always use the maven command to compile and run liberty server for each project. Before doing so be sure to have set the KAFKA_BROKERS and KAFKA_API_KEY environment variables with the <code>setenv.sh</code> command coming from the <code>refarch-kc</code> project, which should be at the same level in folder hierarchy as this repository.</p>
<div class="codehilite"><pre><span></span>source ../../refarch-kc/scripts/setenv.sh IBMCLOUD
</pre></div>

<div class="codehilite"><pre><span></span>mvn install
mvn liberty:run-server
</pre></div>

<h3 id="with-docker-compose">With docker compose</h3>
<p>To run the complete solution locally we use <a href="https://github.com/ibm-cloud-architecture/refarch-kc/blob/master/docker/kc-solution-compose.yml">docker compose</a> from the root <code>refarch-kc</code> project.</p>
<div class="codehilite"><pre><span></span>docker-compose -f backbone-compose.yml up
docker-compose -f kc-solution-compose.yml up
</pre></div>

<p>And to stop everything:</p>
<div class="codehilite"><pre><span></span>docker-compose -f kc-solution-compose.yml down
docker-compose -f backbone-compose.yml down
</pre></div>

<h2 id="deploy-on-kubernetes-cluster">Deploy on kubernetes cluster</h2>
<p>See <a href="../deployments/">this note.</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../implementation-considerations/" title="Implementation considerations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Implementation considerations
              </span>
            </div>
          </a>
        
        
          <a href="../deployments/" title="Deploy to Kubernetes cluster" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Deploy to Kubernetes cluster
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>